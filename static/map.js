var suggestion = {
    "Name of the Place ": [
        "Terraced Garden",
        "Garden of Silence",
        "Topiary Park",
        "Chandigarh Botanical Garden ",
        "International Dolls Museum",
        "Government Museum and Art Gallery",
        "Fun City",
        "Le Corbusier Centre",
        "Nek Chand Rock Garden of Chandigarh",
        "Leisure Valley",
        "Sukhana Lake Park",
        "Zakir Hussain Rose Garden",
        "Tank Monument",
        "Open Hand Monument",
        "Bougainvillea Park",
        "Dhanas Lake",
        "Patiala Ki Rao Reserved Forest",
        "Sukhna Wildlife Sanctuary",
        "Kansal Forest Rest House",
        "Chandigarh Architecture Museum",
        "Hibiscus Garden",
        "Butterfly Park ",
        "Cactus Garden ",
        "M.C. Zoological Park, Chhat Bir Zoo, Zirakpur ",
        "Fateh Burj, Chappar Chiri",
        "Eiffel Tower Replica ",
        "Children Traffic Park ",
        "Rose Garden",
        "Shanti Kunj Park ",
        "Yadavindra Gardens, Pinjore ",
        "Peacock Park ",
        "Bird Sanctuary "
    ],
    "Ratings": [
        4.4,
        4.5,
        4.2,
        4.4,
        4.1,
        4.4,
        4.2,
        4.4,
        4.5,
        4.4,
        4.6,
        4.4,
        4.3,
        4.5,
        4.4,
        4.5,
        4.1,
        4.4,
        4.5,
        4.5,
        4.4,
        4.1,
        4.4,
        4.3,
        4.4,
        4.1,
        4.1,
        4.4,
        4.4,
        4.3,
        4.2,
        4.2
    ],
    "Address": [
        "Sector 33B, Sector 33, Chandigarh, 160020",
        "5, Lake Walking Way, Kishangarh, Chandigarh, Punjab 160101",
        "Sub. City Center, Sector 35A, Chandigarh, 160035",
        "Sarangpur, Chandigarh, 160014",
        "Bal Bhawan, Udyog Path, Sector 23B, Chandigarh, 160023",
        "#502 sector, 10C, Chandigarh, 160011",
        "Elante Mall Patio, Purv Marg, Phase 1, Ram Darbar, Chandigarh, 160002",
        "Sector 19B Old Architect Building, Madhya Marg, Chandigarh, Punjab 160019",
        "Uttar Marg, Rock Garden of Chandigarh, Sector 1, Chandigarh, 160001",
        "10B, Sector 10B, Chandigarh, 160011",
        "Sector 6, Chandigarh, 160019",
        "Jan Marg, 16B, Sector 16, Chandigarh, 160016",
        "10C, Sector 10, Chandigarh, 160011",
        "31, Uttar Marg, Capitol Complex, Sector 1, Chandigarh, 160001",
        "3B, Sector 3, Chandigarh, 160001",
        "Dhanas Main Rd, Dhanas, Chandigarh, 160014",
        "3288, HBC, Dhanas, Chandigarh, 160014",
        "North-East Of Sukhna Lake, Chandigarh, India",
        "Unnamed Rd, Chandigarh, Kansal, 133301",
        "Museum and Art Gallery, Sector 10, Chandigarh, 160011",
        "Hibiscus Garden Rd, 36A, Sector 36, Chandigarh, 160036",
        "Sector 26, Chandigarh, 160019",
        "Panchkula Urban Estate, Sector 5, Panchkula, Haryana 134108",
        "Chattbir Zoo Rd, Chhat, Punjab 140603",
        "Chappar Chiri, Sector 93, Sahibzada Ajit Singh Nagar, Punjab 140307",
        "Leisure Valley, 10C, Sector 10C, Chandigarh, 160011",
        "Udyan Path, 23A, Sector 23, Chandigarh, 160023",
        "Phase 3B-1, Sector 60, Sahibzada Ajit Singh Nagar, Chandigarh 160059",
        "16C, Sector 16, Chandigarh, 160015",
        "Ambala, Kalka - Shimla Rd, Pinjore, Haryana 134102",
        "39A, Sector 39, Chandigarh, 160036",
        "279, Ward Number IV, Himalaya Marg, Sector 21A, Sector 21B, Sector 21, Chandigarh 160022"
    ],
    "Type of Place": [
        "Garden",
        "Tourist Attraction",
        "Tourist Attraction",
        "Tourist Attraction",
        "Children's Museum",
        "Art Museum",
        "Children's amusement center",
        "History Museum",
        "Museum",
        "Park",
        "Tourist Attraction",
        "Garden",
        "Monument",
        "Monument",
        "Park",
        "Tourist Attraction",
        "Nature Preserve",
        "Nature Preserve",
        "Tourist Attraction",
        "Museum",
        "Garden",
        "Park",
        "Garden",
        "Zoo",
        "Tourist Attraction",
        "Garden",
        "Park",
        "Park",
        "Park",
        "Garden",
        "Park",
        "National Park"
    ],
    "Opening Time": [
        "5:30 AM",
        "6:00 AM",
        "Open 24hrs",
        "Open 24hrs",
        "10:00",
        "10:00 AM",
        "11:00 AM",
        "10:00 AM",
        "9:00 AM",
        "Open 24hrs",
        "4:00 AM",
        "6:00 AM",
        "Open 24hrs",
        "9:00 AM",
        "Open 24hrs",
        "Open 24hrs",
        "10:00 AM",
        "9:00 AM",
        "9:00 AM",
        "10:00 AM",
        "Open 24hrs",
        "8:30 AM",
        "8:00 AM",
        "9:30 AM",
        "10:00 AM",
        "Open 24hrs",
        "9:00 AM",
        "6:00 AM",
        "Open 24hrs",
        "7:00 AM",
        "8:00 AM",
        "5:00 AM"
    ],
    "Closing Time": [
        "9:00 PM",
        "10:00 PM",
        "Open 24hrs",
        "Open 24hrs",
        "4:30 PM",
        "4:30 PM",
        "10:00 PM",
        "5:00 PM",
        "8:00 PM",
        "Open 24hrs",
        "10:00 PM",
        "10:00 PM",
        "Open 24hrs",
        "8:00 PM",
        "Open 24hrs",
        "Open 24hrs",
        "8:00 PM",
        "9:00 PM",
        "5:00 PM",
        "8:00 PM",
        "Open 24hrs",
        "5:00 PM",
        "6:00 PM",
        "4:30 PM",
        "7:00 PM",
        "Open 24hrs",
        "9:00 PM",
        "8:00 PM",
        "Open 24hrs",
        "9:30 PM",
        "5:00 PM",
        "8:15 PM"
    ],
    "Unnamed: 6": [
        null,
        null,
        null,
        null,
        "Monday Closed",
        "Monday Closed",
        "Sunday Monday Closing Time 7:30 PM",
        null,
        "Sunday Closing Time 3:45 PM",
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
    ]
};
var placesid = {
    "Terraced Garden": 0,
    "Garden of Silence": 1,
    "Topiary Park": 2,
    "Chandigarh Botanical Garden": 3,
    "International Dolls Museum": 4,
    "Government Museum and Art Gallery": 5,
    "Fun City": 6,
    "Le Corbusier Centre": 7,
    "Nek Chand Rock Garden of Chandigarh": 8,
    "Leisure Valley": 9,
    "Sukhana Lake Park": 10,
    "Zakir Hussain Rose Garden": 11,
    "Tank Monument": 12,
    "Open Hand Monument": 13,
    "Bougainvillea Park": 14,
    "Dhanas Lake": 15,
    "Patiala Ki Rao Reserved Forest": 16,
    "Sukhna Wildlife Sanctuary": 17,
    "Kansal Forest Rest House": 18,
    "Chandigarh Architecture Museum": 19,
    "Hibiscus Garden": 20,
    "Butterfly Park ": 21,
    "Cactus Garden ": 22,
    "M.C. Zoological Park, Chhat Bir Zoo, Zirakpur": 23,
    "Fateh Burj, Chappar Chiri": 24,
    "Eiffel Tower Replica ": 25,
    "Children Traffic Park ": 26,
    "Rose Garden": 27,
    "Shanti Kunj Park ": 28,
    "Yadavindra Gardens, Pinjore ": 29,
    "Peacock Park ": 30,
    "Bird Sanctuary ": 31
}
var coordlist = [];
var graph = [];
window.onload = () => {
    const oldobj = document.querySelectorAll('input');
    var destination_count = 2;
    const datalistobj = document.querySelector('#places');
    for (let j = 0; j < 10; j++) {
        oldobj[j].oninput = (e) => {
            let emptyarray = [];
            if (e.target.value) {
                emptyarray = suggestion["Name of the Place "].filter((data) => {
                    return data.toLowerCase().startsWith(e.target.value);
                });
            }
            let j = 0;
            let optionlist = datalistobj.querySelectorAll('option');
            for (i of optionlist) {
                if (j < emptyarray.length) {
                    i.value = emptyarray[j];
                    j++;
                    continue;
                }
                i.value = "";
            }
        }
    }
    const button = document.querySelector('#add');
    button.onclick = event => {
        if (destination_count < 10) {
            const inputobj = document.querySelectorAll('.input-box')[destination_count];
            inputobj.style.display = "";
            destination_count++;
        }
    }
    const inputobj = document.querySelector('input');
    inputobj.onchange = "console.log(`Text Changed to ${document.querySelectorAll('input')[2].value}`)";
    const button2 = document.querySelector('#create');
    button2.onclick = () => {
        const input_list = document.querySelectorAll("input");
        const Destination_list = [];
        for (let i = 0; i < input_list.length; i++) {
            if (input_list[i].value.length > 0) Destination_list.push(input_list[i].value);
        }
        console.log(Destination_list);
        var temp = "";
        for (let place of Destination_list) {
            const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${place.replace(/ /g, '%20')}.json?limit=1&bbox=76.704402,30.667079,76.84904,30.7951&access_token=${mapboxgl.accessToken.replace(/ /g, '%20')}`;
            console.log(url);
            const req1 = new XMLHttpRequest();
            //console.log(req1.response);

            req1.open('GET', url, true);
            req1.onload = function() {
                const json = JSON.parse(req1.response);

                const coord1 = json.features[0].geometry.coordinates;

                coordlist.push(coord1.join(","));
                console.log(coord1[0]);
            }
            req1.send();
        }
        setTimeout(() => {
            getroute(coordlist.join(";"));
        }, 500);
    } /*---------------------------------------------------------Map----------------------------------------------------------------*/
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2VqYWxrdW1hcjM3MSIsImEiOiJja2xmYnZ5M2UxaHI3MndzNDIzOG1oeGVnIn0.bX5aPbwBZx1wiVBlMGoJ9A';
    navigator.geolocation.getCurrentPosition(successLocation, errorLocation, {
        enableHighAccuracy: true
    })


    function setupMap(center) {

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [76.7794, 30.7333],
            zoom: 12
        });

        const nav = new mapboxgl.NavigationControl();
        map.addControl(nav);
        return map;
    }

    function successLocation(position) {
        setupMap([position.coords.longitude, position.coords.latitude])
    }

    function errorLocation() {
        setupMap([76.7794, 30.7333])

    }

    function getroute(string) {
        //console.log(coordlist);
        /*var string = "";
        for (let i = 0; i < coordlist.length; i++) {
            console.log(coordlist[0]);
            string = string + coordlist[i][0] + "," + coordlist[i][1];
        }*/

        let url = `https://api.mapbox.com/directions/v5/mapbox/driving/${string}?annotations=maxspeed&overview=full&geometries=geojson&access_token=${mapboxgl.accessToken.replace(/ /g, '%20')}`;
        console.log(string);
        let req = new XMLHttpRequest();
        req.open('GET', url, true);
        req.onload = function() {
            var json = JSON.parse(req.response);
            var data = json.routes[0];
            var route = data.geometry.coordinates;
            var geojson = {
                type: 'Feature',
                properties: {},
                geometry: {
                    type: 'LineString',
                    coordinates: route
                }
            };
            // if the route already exists on the map, reset it using setData
            //if (map.getSource('route')) {
            //   map.getSource('route').setData(geojson);
            //} else { // otherwise, make a new request
            window.map.addLayer({
                id: 'route',
                type: 'line',
                source: {
                    type: 'geojson',
                    data: {
                        type: 'Feature',
                        properties: {},
                        geometry: {
                            type: 'LineString',
                            coordinates: geojson
                        }
                    }
                },
                layout: {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                paint: {
                    'line-color': '#3887be',
                    'line-width': 5,
                    'line-opacity': 0.75
                }
            });
            //}
            // add turn instructions here at the end
        };
        req.send();

    }

}